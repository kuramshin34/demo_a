= ConsumeKafka 2.2.0

Потребляет сообщения от Apache Kafka Consumer API. Соответствующий процессор NiFi для отправки сообщений - PublishKafka. Процессор поддерживает потребление сообщений Kafka, при необходимости интерпретируемых как записи NiFi. Обратите внимание, что в настоящее время (в режиме чтения записей) процессор предполагает, что все записи, полученные из данной раздела, имеют одинаковую схему. Для этого режима, если какие-либо из Kafka сообщений не могут быть распарсены или записаны с настроенным читателем записей или пишущим записями, содержимое сообщения будет записано в отдельный FlowFile, и этот FlowFile будет передан в отношение 'parse.failure'. В противном случае каждый FlowFile отправляется в отношение 'success' и может содержать несколько индивидуальных сообщений в одном FlowFile. Добавляется атрибут 'record.count', указывающий, сколько сообщений содержится в FlowFile. Если два Kafka сообщения не могут быть помещены в один и тот же FlowFile из-за различных схем или значений заголовка сообщения, включенного свойством <Headers to Add as Attributes>, ни одно из этих сообщений не будет размещено в один FlowFile.

[horizontal]
*Tags* (Ключевые слова):
Consume, Get, Ingest, Ingress, Kafka, PubSub, Record, Topic, avro, csv, json
[horizontal]
*Input Requirement* (Требования к вводу данных):
FORBIDDEN
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Kafka Connection Service*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Kafka Connection Service (Kafka Connection Service)

[horizontal]
*DESCRIPTION (Описание):*:: Provides connections to Kafka Broker for publishing Kafka Records


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Group Id*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Group ID (Групповой идентификатор)

[horizontal]
*DESCRIPTION (Описание):*:: Kafka Consumer Group Identifier corresponding to Kafka group.id property


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Topic Format*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Формат темы

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, предоставлены ли темы в виде полного имени темы или запятой разделенного списка имен


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* names: Тема - это полное имя темы или запятой разделенный список имен 

* pattern: Тема - это регулярное выражение в соответствии с синтаксисом Java Pattern 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Topics*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Topics (Темы)

[horizontal]
*DESCRIPTION (Описание):*:: Название или шаблон Kafka топиков, из которых процессор потребляет записи Kafka. Можно указать более одного, если разделены запятыми.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Auto.Offset.Reset*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Auto Offset Reset (Автоматическая настройка смещения)

[horizontal]
*DESCRIPTION (Описание):*:: Настройка смещения, применяемая автоматически, если не найден предыдущий смещение для свойства auto.offset.reset Kafka


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* earliest (первый): Автоматически сбросить смещение в самое первое 

* latest (последний): Автоматически сбросить смещение в самое последнее 

* none (нет): Выбросить исключение для потребителя, если не найден предыдущий смещение для группы потребителей 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Commit Offsets*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Commit Offsets (Смещения фиксации)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, должен ли этот процессор зафиксировать смещения в Kafka после получения сообщений. Как правило, это значение следует установить в true, чтобы избежать дублирования полученных сообщений. Однако в определенных сценариях мы можем захотеть избежать фиксации смещений, что позволит данным быть обработанными позже и подтвержденными PublishKafka с целью обеспечения семантики 'точно один раз'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Max Uncommitted Time*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Max Uncommitted Time (Максимальное время без подтверждения)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает максимальное количество времени, разрешенное для пропуска до того, как должны быть зафиксированы смещения. Это значение влияет на частоту фиксации смещений. Фиксацию смещений реже увеличивает пропускную способность, но также увеличивает окно потенциального дублирования данных в случае перебалансировки или перезапуска JVM между фиксациями. Это значение также связано с максимальным количеством записей опроса и использованием демаркатора сообщений. При использовании демаркатора сообщений мы можем иметь гораздо больше неподтвержденных сообщений, чем когда этого не делаем, так как в памяти меньше для отслеживания.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Header Name Pattern
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Header Name Pattern (Шаблон имени заголовка)

[horizontal]
*DESCRIPTION (Описание):*:: Регулярное выражение, применяемое к именам заголовков Kafka Record для выбора значений заголовков, которые будут записываться как атрибуты FlowFile


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Header Encoding*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Header Encoding (Кодировка заголовка)

[horizontal]
*DESCRIPTION (Описание):*:: Character encoding applied when reading Kafka Record Header values and writing FlowFile attributes (Кодировка, применяемая при чтении значений заголовков Kafka Record и записи атрибутов FlowFile)


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: 
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Processing Strategy*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Processing Strategy (Стратегия обработки)

[horizontal]
*DESCRIPTION (Описание):*:: Стратегия для обработки записей Kafka и записи сериализованного вывода в FlowFiles


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* FLOW_FILE (FLOW_FILE): Запись одного FlowFile для каждой потребленной записи Kafka 

* DEMARCATOR (ДЕМАРКАТОР): Запись одного FlowFile для каждой партии потребленных записей Kafka (необязательно сгруппированных по ключу Kafka) 

* RECORD (ЗАПИСЬ): Запись одного FlowFile, содержащего несколько потребленных и обработанных записей Kafka с использованием Record Reader и Record Writer 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Record Reader*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Record Reader (Записыватель записей)

[horizontal]
*DESCRIPTION (Описание):*:: The Record Reader to use for incoming Kafka messages


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Record Writer*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Записыватель записей (Record Writer)

[horizontal]
*DESCRIPTION (Описание):*:: Используйте записывателя записей для сериализации исходящих FlowFiles


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Output Strategy*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Output Strategy (Стратегия вывода)

[horizontal]
*DESCRIPTION (Описание):*:: Формат, используемый для вывода записи Kafka в запись FlowFile.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Use Content as Value (Использовать содержимое как значение): Записывать только значение записи Kafka в запись FlowFile. 

* Use Wrapper (Использовать обертку): Записать ключ, значение, заголовки и метаданные записи Kafka в запись FlowFile. (См. использование процессора для получения дополнительной информации.) 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Key Attribute Encoding*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Key Attribute Encoding (Кодирование атрибута ключа)

[horizontal]
*DESCRIPTION (Описание):*:: Кодирование для значения настроенного атрибута FlowFile, содержащего ключ записи Kafka.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* UTF-8 Encoded (Кодированный в UTF-8): Ключ интерпретируется как строка, закодированная в UTF-8. 

* Hex Encoded (Шестнадцатеричное кодирование): Ключ интерпретируется как произвольные двоичные данные и кодируется с использованием шестнадцатеричных символов с заглавными буквами. 

* Do Not Add Key as Attribute (Не добавлять ключ в качестве атрибута): Ключ не будет добавлен как атрибут. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Key Format*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Key Format (Формат ключа)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, как представить ключ записи Kafka в выходном потоке FlowFile


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* String (Строка): Формат ConsumerRecord ключа как строки UTF-8. 

* Byte Array (Массив байтов): Формат ConsumerRecord ключа как массива байтов. 

* Record (Запись): Формат ConsumerRecord ключа как записи. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Key Record Reader*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Key Record Reader (Ключ Записи Читателя)

[horizontal]
*DESCRIPTION (Описание):*:: Чтец записей для использования при разборе ключа Kafka записи в запись


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Message Demarcator*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Message Demarcator (Маркер сообщения)

[horizontal]
*DESCRIPTION (Описание):*:: Поскольку KafkaConsumer получает сообщения пачками, этот процессор имеет параметр для вывода FlowFiles, которые содержат все Kafka-сообщения в одной пачке для заданной темы и раздела. Это свойство позволяет предоставить строку (интерпретируемую как UTF-8), которую следует использовать для разграничения нескольких Kafka-сообщений. Это необязательное свойство, и если оно не предоставлено, каждое полученное Kafka-сообщение приведет к отдельному FlowFile, которое будет создано при срабатывании. Для ввода специальных символов, таких как 'новая строка', используйте CTRL+Enter или Shift+Enter в зависимости от операционной системы.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Separate By Key*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Separate By Key (Разделять по ключу)

[horizontal]
*DESCRIPTION (Описание):*:: Когда это свойство включено, два сообщения будут добавлены в один поток только если оба Kafka-сообщения имеют идентичные ключи.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************










=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`success`
|FlowFiles содержащие одну или несколько сериализованных записей Kafka

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`record.count`
|Количество полученных записей

|`mime.type`
|Тип MIME, предоставляемый настроенным пишущим записями

|`kafka.count`
|Количество записей, записанных, если их больше одного

|`kafka.key`
|Ключ сообщения, если он присутствует и является единственным. Как закодирован ключ зависит от значения свойства 'Key Attribute Encoding'.

|`kafka.offset`
|Смещение сообщения в разделе темы.

|`kafka.timestamp`
|Временная метка сообщения в разделе темы.

|`kafka.partition`
|Раздел темы, откуда получено сообщение или набор сообщений

|`kafka.topic`
|Тема, откуда получено сообщение или набор сообщений

|`kafka.tombstone`
|Устанавливается в true, если потребляемое сообщение является 'сообщением-призраком'

|===







=== Смотрите также


* xref:Processors/PublishKafka.adoc[PublishKafka]


