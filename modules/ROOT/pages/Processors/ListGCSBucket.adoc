= ListGCSBucket 2.2.0

Извлекает список объектов из облачного хранилища GCS. Для каждого перечисленного объекта создает FlowFile, который представляет собой объект для дальнейшего получения вместе с FetchGCSObject. Этот процессор предназначен для выполнения только на основном узле кластера. Если основной узел меняется, новый основной узел продолжит работу с места остановки предыдущего узла без дублирования всех данных.

[horizontal]
*Tags* (Ключевые слова):
gcs, google, google cloud, list, storage
[horizontal]
*Input Requirement* (Требования к вводу данных):
FORBIDDEN
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Gcp Credentials Provider Service*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: GCP Credentials Provider Service (Google Cloud Platform Учебный класс для получения учетных данных)

[horizontal]
*DESCRIPTION (Описание):*:: The Controller Service used to obtain Google Cloud Platform credentials.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Gcp-Project-Id
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Project ID (Проектный идентификатор)

[horizontal]
*DESCRIPTION (Описание):*:: Google Cloud Project ID (Идентификатор проекта в Google Cloud)


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Gcs-Bucket*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Bucket (Бакет)

[horizontal]
*DESCRIPTION (Описание):*:: Bucket of the object.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Gcs-Prefix
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Prefix (Префикс)

[horizontal]
*DESCRIPTION (Описание):*:: The prefix used to filter the object list. In most cases, it should end with a forward slash ('/').


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Listing-Strategy*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Listing Strategy (Стратегия перечисления)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как определять новые или обновленные сущности. Подробнее о каждой стратегии см. в описании.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Timestamps (Отслеживание временных меток): Эта стратегия отслеживает последнюю временную метку перечисленной сущности для определения новых или обновленных сущностей. Поскольку она отслеживает только несколько временных меток, она может эффективно управлять состоянием перечисления. Эта стратегия не выберет никакие новые или измененные сущности, если их временные метки старше отслеживаемых последних временных меток. Также может пропустить файлы, когда одновременно записывается несколько поддиректорий при перечислении. 

* Tracking Entities (Отслеживание сущностей): Эта стратегия отслеживает информацию обо всех перечисленных сущностях в пределах последнего 'Entity Tracking Time Window' для определения новых или обновленных сущностей. Эта стратегия может выбрать сущности с устаревшей временной меткой, которая может быть пропущена при использовании 'Tracing Timestamps'. Работает даже если одновременно записываются несколько поддиректорий при перечислении. Однако требует дополнительного контроллера службы DistributedMapCache и большего объема памяти JVM. Подробнее о том, как работает свойство 'Entity Tracking Time Window', см. в описании. 

* No Tracking (Без отслеживания): Эта стратегия перечисляет все сущности без какого-либо отслеживания. Одни и те же сущности будут перечисляться каждый раз при запланированном запуске этого процессора. Рекомендуется изменить значение параметра 'default run schedule'. Любая свойство, относящаяся к сохранению состояния, будет проигнорирована. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Et-State-Cache*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking State Cache (Состояние кэша отслеживания сущностей)

[horizontal]
*DESCRIPTION (Описание):*:: Перечисленные сущности хранятся в указанном хранилище кэша, что позволяет этому процессору возобновить перечисление после перезапуска NiFi или изменения основного узла. Стратегия 'Отслеживание сущностей' требует отслеживания информации обо всех перечисленных сущностях в течение последнего 'Окна времени отслеживания'. Для поддержки большого количества сущностей стратегия использует DistributedMapCache вместо управляемого состояния. Формат ключа кэша имеет вид 'ListedEntities::{processorId}(::{nodeId})'. Если отслеживаются перечисленные сущности на узле, то к ключу добавляется необязательная часть '::{nodeId}' для управления состоянием отдельно. Например, глобальный ключ кэша = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b', ключ кэша для узла = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b::nifi-node3' Содержимое сжатой JSON строки хранится в кэше. Ключ будет удален, когда изменится конфигурация целевого перечисления. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Et-Initial-Listing-Target
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Initial Listing Target (Целевая сущность для начального списка отслеживания)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как следует обрабатывать начальный список. Используется стратегией 'Отслеживание Сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Time Window (Окно отслеживания времени): Игнорировать сущности, имеющие временную метку старше указанного 'Окна отслеживания времени' при начальной активности списка. 

* All Available (Все доступные): Независимо от временной метки сущностей, все существующие сущности будут перечислены при начальной активности списка. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Et-Time-Window*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Time Window (Временное окно отслеживания сущности)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как долго этот процессор должен отслеживать уже занесенные в список сущности. Стратегия 'Отслеживание сущностей' может выбрать любую сущность, временная метка которой находится внутри указанного временного окна. Например, если установлено значение '30 минут', любая сущность с временной меткой в течение последних 30 минут будет целью включения при выполнении этого процессора. Занесенная сущность считается 'новой/обновленной' и генерируется FlowFile, если выполняется одно из следующих условий: 1. не существует в уже занесенных сущностях, 2. имеет более новую временную метку, чем кэшированная сущность, 3. имеет разный размер по сравнению с кэшированной сущностью. Если временная метка кэшированной сущности становится старше указанного временного окна, эта сущность будет удалена из кэшированных уже занесенных сущностей. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Record-Writer
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Record Writer (Записыватель записей)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает записыватель записей для создания списка. Если не указан, будет создан один FlowFile для каждой перечисленной сущности. Если указать записыватель записей, все сущности будут записаны в один FlowFile вместо добавления атрибутов к отдельным FlowFiles.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Gcs-Use-Generations*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Use Generations (Использовать Генерации)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, следует ли использовать GCS Generations, если это применимо. Если false, будет возвращена только последняя версия каждого объекта.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Gcp-Retry-Count*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Number of retries (Количество повторных попыток)

[horizontal]
*DESCRIPTION (Описание):*:: How many retry attempts should be made before routing to the failure relationship. (Сколько повторных попыток следует предпринять перед тем, как передать управление в связанное отношение отказа)


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Storage-Api-Url
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Storage API URL (URL хранилища)

[horizontal]
*DESCRIPTION (Описание):*:: Переопределяет стандартный URL-адрес хранилища. Настройка альтернативного URL-адреса Storage API также переопределяет заголовок HTTP Host в запросах, как описано в документации Google для частных сервисных подключений.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Proxy-Configuration-Service
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Proxy Configuration Service (Сервис конфигурации прокси)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает сервис контроллера прокси-серверов для проксирования сетевых запросов. Поддерживаемые прокси: HTTP + AuthN


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************




=== Управление состоянием

[cols="1a,2a",options="header",]
|===
|Масштаб |Описание

|
CLUSTER

|После выполнения перечисления ключей сохраняется временная метка самого нового ключа, а также ключи, которые разделяют эту же метку. Это позволяет процессору перечислять только ключи, добавленные или измененные после этой даты при следующем запуске процессора. Состояние хранится в кластере, чтобы этот процессор мог выполняться только на основном узле и если новый основной узел будет выбран, новый узел сможет продолжить работу без дублирования данных.
|===







=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`success`
|FlowFiles передаются в это отношение после успешной операции с облачным хранилищем Google Cloud.

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`filename`
|Имя файла

|`gcs.bucket`
|Бакет объекта.

|`gcs.key`
|Имя объекта.

|`gcs.size`
|Размер объекта.

|`gcs.cache.control`
|Управление кэшем данных объекта.

|`gcs.component.count`
|Количество компонентов, составляющих объект.

|`gcs.content.disposition`
|Данные контент-диспозишн объекта.

|`gcs.content.encoding`
|Кодировка содержимого объекта.

|`gcs.content.language`
|Язык контента объекта.

|`mime.type`
|MIME/Content-Type объекта

|`gcs.crc32c`
|Контрольная сумма CRC32C объекта, закодированная в base64 в порядке big-endian.

|`gcs.create.time`
|Время создания объекта (в миллисекундах)

|`gcs.update.time`
|Последнее время модификации объекта (в миллисекундах)

|`gcs.encryption.algorithm`
|Алгоритм, используемый для шифрования объекта.

|`gcs.encryption.sha256`
|SHA256-хэш ключа, используемого для шифрования объекта

|`gcs.etag`
|HTTP 1.1 Entity tag для объекта.

|`gcs.generated.id`
|Уникальный идентификатор, сгенерированный сервисом

|`gcs.generation`
|Поколение данных объекта.

|`gcs.md5`
|MD5-хэш данных объекта, закодированный в base64.

|`gcs.media.link`
|Ссылка на медиа-загрузку для объекта.

|`gcs.metageneration`
|Метапоколение объекта.

|`gcs.owner`
|Владелец (загрузчик) объекта.

|`gcs.owner.type`
|Тип ACL-сущности загрузчика объекта.

|`gcs.acl.owner`
|Список сущностей ACL, имеющих доступ к объекту в качестве владельца. Сущности могут быть адресами электронной почты, доменами или идентификаторами проекта.

|`gcs.acl.writer`
|Список сущностей ACL, имеющих право на запись в объект. Сущности могут быть адресами электронной почты, доменами или идентификаторами проекта.

|`gcs.acl.reader`
|Список сущностей ACL, имеющих право на чтение объекта. Сущности могут быть адресами электронной почты, доменами или идентификаторами проекта.

|`gcs.uri`
|URI объекта в виде строки.

|===







=== Смотрите также


* xref:Processors/DeleteGCSObject.adoc[DeleteGCSObject]

* xref:Processors/FetchGCSObject.adoc[FetchGCSObject]

* xref:Processors/PutGCSObject.adoc[PutGCSObject]


