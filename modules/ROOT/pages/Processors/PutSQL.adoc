= PutSQL 2.2.0

Выполняет SQL UPDATE или INSERT команду. Ожидается, что содержимое входящего FlowFile будет представлять собой SQL команду для выполнения. Команда SQL может использовать ? для экранирования параметров. В этом случае параметры, которые нужно использовать, должны существовать как атрибуты FlowFile с именами sql.args.N.type и sql.args.N.value, где N — положительное целое число. Ожидается, что содержимое FlowFile будет в формате UTF-8.

[horizontal]
*Tags* (Ключевые слова):
database, insert, put, rdbms, relational, sql, update
[horizontal]
*Input Requirement* (Требования к вводу данных):
REQUIRED
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Jdbc Connection Pool*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: JDBC Connection Pool (JDBC Подключение к пулу)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, какой JDBC Connection Pool использовать для преобразования JSON-сообщения в SQL-заявление. Для этого необходим пул соединений, чтобы определить подходящие типы столбцов базы данных.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Putsql-Sql-Statement
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: SQL Statement (Заявление)

[horizontal]
*DESCRIPTION (Описание):*:: SQL-заявление для выполнения. Заявление может быть пустым, константным значением или построено из атрибутов с использованием языка выражений. Если это свойство указано, оно будет использоваться независимо от содержимого поступающих FlowFiles. Если это свойство пустое, ожидается, что содержимое входящего FlowFile будет содержать допустимое SQL-заявление, которое будет выполнено процессором к базе данных.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Support Fragmented Transactions
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Support Fragmented Transactions (Поддержка фрагментированных транзакций)

[horizontal]
*DESCRIPTION (Описание):*:: Если true, когда FlowFile потребляется этим процессором, процессор сначала проверяет атрибуты fragment.identifier и fragment.count этого FlowFile. Если значение fragment.count больше 1, процессор не будет обрабатывать ни один FlowFile с этим fragment.identifier до тех пор, пока все они не станут доступны; в этот момент он обработает все FlowFiles с этим fragment.identifier как единую транзакцию, в порядке, указанном атрибутами fragment.index FlowFiles's. Это обеспечивает атомарность этих SQL-операторов. Как только при выполнении какой-либо операции этой транзакции возникает исключение, вся транзакция откатывается. Когда происходит откат транзакции, ни один из этих FlowFiles не будет направлен в 'success'. Если установлено значение <Rollback On Failure> true, эти FlowFiles останутся в отношении ввода. Если установлено значение <Rollback On Failure> false, если какой-либо из этих FlowFiles будет направлен в 'retry', все эти FlowFiles будут направлены в 'retry'. В противном случае они будут направлены в 'failure'. Если это значение равно false, будут проигнорированы эти атрибуты, и обновления произойдут независимо друг от друга.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Database-Session-Autocommit
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Database Session AutoCommit (База данных Сессия Автокоммит)

[horizontal]
*DESCRIPTION (Описание):*:: Режим автокомита, который нужно установить на используемом базовом соединении. Если установлен в false, операции будут явно зафиксированы или откачены (в зависимости от успешности или неудачи), если установлен в true, драйвер/база данных обрабатывает фиксацию/откат.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true (истина)

* false (ложь)


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Transaction Timeout
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Transaction Timeout (Время ожидания)

[horizontal]
*DESCRIPTION (Описание):*:: Если свойство <Support Fragmented Transactions> установлено в true, указывает, сколько времени ждать, пока все FlowFiles для определенного атрибута fragment.identifier не придут, прежде чем просто передавать все FlowFiles с этим идентификатором в отношение 'failure'


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Batch Size*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Batch Size (Размер партии)

[horizontal]
*DESCRIPTION (Описание):*:: Предпочтительное количество FlowFiles для помещения в базу данных в одной транзакции


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Obtain Generated Keys
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Obtain Generated Keys (Получить сгенерированные ключи)

[horizontal]
*DESCRIPTION (Описание):*:: Если true, любой ключ, автоматически сгенерированный базой данных, будет добавлен в FlowFile, который его сгенерировал, используя атрибут sql.generate.key. Это может привести к несколько более медленной производительности и не поддерживается всеми базами данных.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true (истина)

* false (ложь)


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Rollback-On-Failure*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Rollback On Failure (Спецификация способа обработки ошибок)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как обрабатывать ошибки. По умолчанию (false), если во время обработки FlowFile возникает ошибка, FlowFile будет направлен в 'failure' или 'retry' relationship в зависимости от типа ошибки, и процессор может продолжить с следующим FlowFile. Вместо этого вы можете отменить текущие обработанные FlowFiles и немедленно остановить дальнейшую обработку. В этом случае вы можете включить эту 'Rollback On Failure' свойство. Если оно включено, неудачные FlowFiles останутся в input relationship без штрафа и будут повторно обрабатываться до тех пор, пока не будет успешно обработано или удалено другими способами. Важно установить соответствующую 'Yield Duration', чтобы избежать чрезмерного повтора.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************










=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`retry`
|FlowFile направляется в эту связь, если база данных не может быть обновлена, но повторная попытка может привести к успеху

|`success`
|FlowFile направляется в эту связь после успешной обновления базы данных

|`failure`
|FlowFile направляется в эту связь, если база данных не может быть обновлена, и повторная попытка также не удастся, например из-за недопустимого запроса или нарушения целостности

|===



=== Читаемые атрибуты

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`fragment.identifier`
|Если свойство <Support Fragment Transactions> установлено в true, этот атрибут используется для определения, принадлежат ли два FlowFile к одной транзакции.

|`fragment.count`
|Если свойство <Support Fragment Transactions> установлено в true, этот атрибут используется для определения количества FlowFile, необходимых для завершения транзакции.

|`fragment.index`
|Если свойство <Support Fragment Transactions> установлено в true, этот атрибут используется для определения порядка оценки FlowFile в транзакции.

|`sql.args.N.type`
|Входящие FlowFile ожидаются как параметризованные SQL-операторы. Тип каждого параметра указывается целым числом, представляющим JDBC Type параметра.

|`sql.args.N.value`
|Входящие FlowFile ожидаются как параметризованные SQL-операторы. Значения параметров указываются как sql.args.1.value, sql.args.2.value, sql.args.3.value и так далее. Тип параметра sql.args.1.value указывается атрибутом sql.args.N.type.

|`sql.args.N.format`
|Этот атрибут всегда является необязательным, но стандартные параметры могут не работать для ваших данных. Входящие FlowFile ожидаются как параметризованные SQL-операторы. В некоторых случаях необходимо указать формат опции, которая в настоящее время применима только для двоичных данных, дат, времени и отметок времени. Двоичные данные (по умолчанию 'ascii') - каждый строковый символ вашего атрибута представляет собой отдельный байт. Это формат, предоставляемый процессорами Avro. base64: строка является закодированной в Base64 строкой, которая может быть декодирована в байты. hex: строка представляет собой шестнадцатеричный код с всеми буквами в верхнем регистре и без '0x' в начале. Форматы дат/времени/отметок времени - форматы Date, Time и Timestamp поддерживают как пользовательские форматы, так и именованные форматы ('yyyy-MM-dd','ISO_OFFSET_DATE_TIME') в соответствии с java.time.format.DateTimeFormatter. Если не указан, ожидается входное значение типа long, представляющее unix эпоху (миллисекунды с 1970/1/1), или строковое значение в формате 'yyyy-MM-dd' для Date, 'HH:mm:ss.SSS' для Time (некоторые движки баз данных, такие как Derby или MySQL, не поддерживают миллисекунды и усекут миллисекунды), 'yyyy-MM-dd HH:mm:ss.SSS' для Timestamp.

|===



=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`sql.generated.key`
|Если база данных сгенерировала ключ для оператора INSERT и свойство <Obtain Generated Keys> установлено в true, этот атрибут будет добавлен для обозначения сгенерированного ключа, если это возможно. Эта функция не поддерживается всеми поставщиками баз данных.

|===







