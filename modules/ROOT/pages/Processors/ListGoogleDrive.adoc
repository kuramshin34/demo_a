= ListGoogleDrive 2.2.0

Выполняет перечисление конкретных файлов (сокращения игнорируются) в папке Google Drive. Если установлено свойство 'Записыватель записи', создается один выходной FlowFile, а каждый файл в перечислении записывается как отдельная запись в выходной файл. В противном случае для каждого файла в перечислении создается отдельный FlowFile, метаданные записываются как атрибуты FlowFile. Этот процессор предназначен для запуска только на основном узле в кластере. Если основной узел изменяется, новый основной узел продолжит работу с места остановки предыдущего узла без дублирования всех данных. Пожалуйста, ознакомьтесь с дополнительными деталями для настройки доступа к Google Drive.

[horizontal]
*Tags* (Ключевые слова):
drive, google, storage
[horizontal]
*Input Requirement* (Требования к вводу данных):
FORBIDDEN
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Gcp-Credentials-Provider-Service*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: GCP Credentials Provider Service (...)

[horizontal]
*DESCRIPTION (Описание):*:: Сервис контроллера, используемый для получения учетных данных Google Cloud Platform.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Folder-Id*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Folder ID (ID папки, из которой будет получен список файлов)

[horizontal]
*DESCRIPTION (Описание):*:: Идентификатор папки, из которой будет забран список файлов. Пожалуйста, ознакомьтесь с дополнительными деталями для настройки доступа к Google Drive и получения идентификатора папки. ВНИМАНИЕ: Неавторизованный доступ к папке считается таким, как если бы папка была пустой. Это приводит к тому, что процессор не создаёт исходящие FlowFiles. Дополнительное сообщение об ошибке не предоставляется.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Recursive-Search*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Search Recursively (Поиск рекурсивно)

[horizontal]
*DESCRIPTION (Описание):*:: Когда 'true', будет включать список файлов из конкретных подпапок (игнорирует ярлыки). В противном случае вернет только файлы, у которых есть определённый 'Folder ID' в качестве прямого родителя. ПРЕДУПРЕЖДЕНИЕ: Список может завершиться неудачей, если подпапок слишком много (500+).


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* true

* false


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Min-Age*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Minimum File Age (Минимальный возраст файла)

[horizontal]
*DESCRIPTION (Описание):*:: The minimum age a file must be in order to be considered; any files younger than this will be ignored.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Listing-Strategy*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Listing Strategy (Стратегия перечисления)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как определять новые или обновленные сущности. Подробнее о каждой стратегии см. в их описаниях.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Timestamps (Отслеживание временных меток): Эта стратегия отслеживает последнюю временную метку перечисленной сущности для определения новых или обновленных сущностей. Поскольку она отслеживает только несколько временных меток, она может эффективно управлять состоянием перечисления. Однако любая новая или обновленная сущность с временной меткой старше отслеживаемой последней временной метки не будет выбрана этой стратегией. Например, такая ситуация может возникнуть в файловой системе, если файл с устаревшей временной меткой скопирован или перемещен в целевую директорию без обновления его последней модификации. Также эта стратегия может пропустить файлы при одновременной записи нескольких поддиректорий, когда перечисление работает. 

* Tracking Entities (Отслеживание сущностей): Эта стратегия отслеживает информацию обо всех перечисленных сущностях в пределах последнего 'Entity Tracking Time Window' для определения новых или обновленных сущностей. Эта стратегия может выбрать сущности с устаревшей временной меткой, которые могут быть пропущены в 'Tracking Timestamps'. Работает даже при одновременной записи нескольких поддиректорий, когда перечисление работает. Однако требуется дополнительный сервис контроллера DistributedMapCache и больше использует память JVM. Подробнее о работе свойства 'Entity Tracking Time Window' см. 

* Time Window (Временное окно): Эта стратегия использует скользящее временное окно. Окно начинается там, где заканчивается предыдущее окно, и заканчивается 'текущим временем'. Одна цикла перечислит файлы с изменением времени в пределах временного окна. Работает даже при одновременной записи нескольких поддиректорий, когда перечисление работает. ВАЖНО: Эта стратегия работает правильно только в том случае, если время на системе, размещающей NiFi, и на системе, размещающей файлы, точное. 

* No Tracking (Без отслеживания): Эта стратегия перечисляет сущность без какого-либо отслеживания. Одна и та же сущность будет перечислена каждый раз при выполнении этого процессора. Рекомендуется изменить значение параметра 'default run schedule'. Любая свойство, относящаяся к сохранению состояния, будет игнорироваться. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Et-State-Cache
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking State Cache (Состояние кэша отслеживания сущностей)

[horizontal]
*DESCRIPTION (Описание):*:: Перечисленные сущности хранятся в указанном хранилище кэша, что позволяет этому процессору возобновить перечисление после перезапуска NiFi или изменения основного узла. Стратегия 'Отслеживание сущностей' требует отслеживания информации обо всех перечисленных сущностях в течение последнего 'Окна времени отслеживания'. Для поддержки большого количества сущностей стратегия использует DistributedMapCache вместо управляемого состояния. Формат ключа кэша имеет вид 'ListedEntities::{processorId}(::{nodeId})'. Если отслеживаются перечисленные сущности на узле, то к ключу добавляется необязательная часть '::{nodeId}' для управления состоянием отдельно. Например, глобальный ключ кэша = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b', ключ кэша для узла = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b::nifi-node3' Содержимое сжатой JSON строки хранится в кэше. Ключ будет удален, когда изменится конфигурация целевого перечисления. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Et-Time-Window
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Time Window (Временное окно отслеживания сущности)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как долго этот процессор должен отслеживать уже занесенные в список сущности. Стратегия 'Отслеживание сущностей' может выбирать любую сущность, временная метка которой находится внутри указанного временного окна. Например, если установлено значение '30 минут', то любое существование со временной меткой в течение последних 30 минут будет целью занесения при выполнении этого процессора. Занесенная сущность считается 'новой/обновленной', и поток данных (FlowFile) испускается, если выполняется одно из следующих условий: 1. не существует в уже занесенных сущностях, 2. имеет более новую временную метку, чем кэшированная сущность, 3. имеет отличный размер от кэшированной сущности. Если временная метка кэшированной сущности становится старше указанного временного окна, эта сущность будет удалена из кэшированных уже занесенных сущностей. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Et-Initial-Listing-Target
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Initial Listing Target (Целевая сущность для начального списка отслеживания)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как следует обрабатывать начальный список. Используется стратегией 'Отслеживание Сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Time Window (Окно отслеживания времени): Игнорировать сущности, имеющие временную метку старше указанного 'Окна отслеживания времени' при начальной активности списка. 

* All Available (Все доступные): Независимо от временной метки сущностей, все существующие сущности будут перечислены при начальной активности списка. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Record-Writer
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Record Writer (Записыватель записей)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает записыватель записей для создания списка. Если не указан, будет создан один FlowFile для каждой перечисленной сущности. Если указать записыватель записей, все сущности будут записаны в один FlowFile вместо добавления атрибутов к отдельным FlowFiles.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Proxy-Configuration-Service
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Proxy Configuration Service (Сервис конфигурации прокси)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает сервис контроллера прокси-серверов для проксирования сетевых запросов. Поддерживаемые прокси: HTTP + AuthN


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************




=== Управление состоянием

[cols="1a,2a",options="header",]
|===
|Масштаб |Описание

|
CLUSTER

|Процессор хранит необходимые данные для отслеживания того, какие файлы уже были перечислены. Что именно нужно хранить, зависит от стратегии перечисления. Состояние хранится в кластере, что позволяет запускать процессор на основном узле только в кластере. Если выбран новый основной узел, он продолжит работу с места остановки предыдущего узла без дублирования данных.
|===







=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`success`
|Все FlowFiles, полученные на входе, направляются в success

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`drive.id`
|Идентификатор файла

|`filename`
|Название файла

|`mime.type`
|MIME-тип файла

|`drive.size`
|Размер файла

|`drive.timestamp`
|Время последней модификации или создания (в зависимости от того, что больше) файла. Причина в том, что оригинальная дата изменения файла сохраняется при загрузке в Google Drive. 'Время создания' берёт время при загрузке. Однако загруженные файлы могут быть изменены позже.

|===







=== Смотрите также


* xref:Processors/FetchGoogleDrive.adoc[FetchGoogleDrive]

* xref:Processors/PutGoogleDrive.adoc[PutGoogleDrive]


