= EnforceOrder 2.2.0

Принудительно обеспечивает ожидаемый порядок FlowFiles, принадлежащих к той же группе данных в рамках одного узла. Хотя PriorityAttributePrioritizer может использоваться для привязки к соединению, чтобы обеспечить порядок flow files на основе приоритета, в зависимости от обработки ошибок, разветвления и других дизайнов потока, возможно, что FlowFiles могут стать неправильным порядком. EnforceOrder может использоваться для принудительного соблюдения первоначального порядка для этих FlowFiles. [ВАЖНО] Для того чтобы EnforceOrder вступило в силу, необходимо использовать FirstInFirstOutPrioritizer на ВСЕХ нижестоящих отношениях ДО ТЕХ ПОР, пока порядок FlowFiles физически не будет устранен операцией, такой как MergeContent или сохранение в конечное место назначения.

[horizontal]
*Tags* (Ключевые слова):
order, sort
[horizontal]
*Input Requirement* (Требования к вводу данных):
REQUIRED
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Group-Id*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Group Identifier (Групповой идентификатор)

[horizontal]
*DESCRIPTION (Описание):*:: EnforceOrder может управлять несколькими группами упорядочения. 'Group Identifier' используется для определения, к какой группе относится FlowFile. Это свойство будет оцениваться с каждым поступающим FlowFile. Если оценка оказывается пустой, FlowFile будет направлен в сбое.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Order-Attribute*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Order Attribute (Порядок атрибута)

[horizontal]
*DESCRIPTION (Описание):*:: Имя FlowFile атрибута, значение которого будет использоваться для обеспечения порядка FlowFiles в группе. Если FlowFile не имеет этого атрибута или его значение не является целым числом, FlowFile будет направлен в сбой.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Initial-Order*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Initial Order (Начальный порядок)

[horizontal]
*DESCRIPTION (Описание):*:: Когда приходит первый FlowFile группы, будет вычислен и сохранён в управляемом состоянии начальный целевой порядок. После этого целевой порядок начнет отслеживаться с помощью EnforceOrder и храниться в хранилище управления состояниями. Если используется язык выражений, но результат оценки не был целым числом, то FlowFile будет направлен в сбой, и начальный порядок останется неизвестен до тех пор, пока последующие FlowFiles предоставят действительный начальный порядок.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Maximum-Order
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Maximum Order (Максимальный порядок)

[horizontal]
*DESCRIPTION (Описание):*:: Если указано, то любой FlowFiles с большим порядком будет направлен в сбое. Это свойство вычисляется только один раз для заданной группы. После вычисления максимального порядка он сохраняется в хранилище управления состоянием и используется для других FlowFiles, принадлежащих той же группе. Если используется язык выражений, но результат оценки не был целым числом, то FlowFile будет направлен в сбое, и максимальный порядок останется неизвестен до тех пор, пока последующие FlowFiles предоставят действительный максимальный порядок.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Batch-Count*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Batch Count (Количество пакетных операций)

[horizontal]
*DESCRIPTION (Описание):*:: Максимальное количество FlowFiles, которые EnforceOrder может обработать при выполнении.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Wait-Timeout*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Wait Timeout (Ожидание таймаута)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает продолжительность, по истечении которой ожидающие FlowFiles будут направлены в отношение 'перехвачено'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Inactive-Timeout*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Inactive Timeout (Период после которого состояние неактивной группы будет очищено из управляемого состояния)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает продолжительность, по истечении которой состояние для неактивной группы будет удалено из управляемого состояния. Группа считается неактивной, если за указанный период новые входящие FlowFile не поступали. Если FlowFile приходит поздно после того, как группа уже была очищена, она будет рассмотрена как новая группа, но никогда не сможет соответствовать порядку, так как ожидаемые предшествующие FlowFile уже исчезли. FlowFile в конечном итоге перейдет в режим ожидания и будет направлен в 'overtook'. Чтобы избежать этого, состояние групп следует хранить достаточно долго, однако более короткая продолжительность может быть полезной для повторного использования того же идентификатора группы.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: 
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************




=== Управление состоянием

[cols="1a,2a",options="header",]
|===
|Масштаб |Описание

|
LOCAL

|EnforceOrder использует следующие состояния для каждой группы упорядочения: '<groupId>.target' - это номер порядка, на который ожидается прибытие следующего. Когда FlowFile с соответствующим порядком прибывает или FlowFile перемещается вперед FlowFile, ожидаемого из-за таймаута ожидания, цельный порядок будет обновлен до (FlowFile.order + 1). '<groupId>.max - это максимальный номер порядка для группы. '<groupId>.updatedAt' - это временная метка последнего обновления порядка группы. Эти управляемые состояния будут автоматически удалены, как только группа будет определена как неактивная, см. 'Inactive Timeout' для деталей.
|===







=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`overtook`
|FlowFile, который ждал предшествующих FlowFiles дольше, чем Wait Timeout, и переместился вперед этих FlowFiles, будет направлен в это отношение.

|`failure`
|FlowFiles, которые не имеют необходимых атрибутов или терпят неудачу при вычислении их, будут направлены в это отношение

|`success`
|FlowFile с соответствующим номером порядка будет направлен в это отношение.

|`skipped`
|FlowFile, который имеет заказ младше текущего, что означает его прибытие слишком поздно и был пропущен, будет направлен в это отношение.

|`wait`
|FlowFile с несоответствующим порядком будет направлен в это отношение

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`EnforceOrder.startedAt`
|Все FlowFiles, проходящие через этот процессор, будут иметь этот атрибут. Это значение используется для определения таймаута ожидания.

|`EnforceOrder.result`
|Все FlowFiles, проходящие через этот процессор, будут иметь этот атрибут, обозначающий, в какое отношение был направлен.

|`EnforceOrder.detail`
|FlowFiles, направленные в 'failure' или 'skipped' отношение, будут иметь этот атрибут, описывающий детали.

|`EnforceOrder.expectedOrder`
|FlowFiles, направленные в 'wait' или 'skipped' отношение, будут иметь этот атрибут, обозначающий ожидаемый порядок при обработке FlowFile.

|===







