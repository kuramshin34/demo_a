= Wait 2.2.0

Маршрутизирует входящие FlowFiles в отношение 'wait' до тех пор, пока соответствующий сигнал выпуска не будет сохранен в распределенном кэше от соответствующего процессора Notify. Когда соответствующий сигнал выпуска идентифицируется, ожидающий FlowFile направляется в отношение 'success'. Сигнал выпуска удаляется из кэша. Атрибуты FlowFile, которые произвели сигнал выпуска, копируются в ожидающий FlowFile, если для свойства Attribute Cache Regex соответствующего процессора Notify установлено правильное значение. Если в кэше идентифицировано несколько сигналов выпуска (обозначенных Release Signal Identifier) и настроен копировать атрибуты FlowFile в кэш, то ожидающий FlowFile, проходящий через процессор Wait, получает объединение атрибутов FlowFiles, которые произвели сигналы выпуска в кэше (идентифицированные по Release Signal Identifier). Ожидающие FlowFiles будут направлены в 'expired', если они превышают установленный срок действия. Если вам нужно дождаться более одного сигнала, укажите желаемое количество сигналов через свойство 'Target Signal Count'. Это особенно полезно с процессорами, которые разделяют исходный FlowFile на несколько фрагментов, например SplitText. Для того чтобы дождаться всех фрагментов, подключите отношение 'original' к процессору Wait, а отношение 'splits' к соответствующему процессору Notify. Настройте процессоры Notify и Wait для использования '${fragment.identifier}' в качестве значения 'Release Signal Identifier', и укажите '${fragment.count}' в качестве значения 'Target Signal Count' в процессоре Wait. Рекомендуется использовать диспетчер приоритетов (например, FIFO) при использовании отношения 'wait' как петли.

[horizontal]
*Tags* (Ключевые слова):
cache, distributed, hold, map, release, signal, wait
[horizontal]
*Input Requirement* (Требования к вводу данных):
REQUIRED
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Release-Signal-Id*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Release Signal Identifier (Идентификатор сигнала выпуска)

[horizontal]
*DESCRIPTION (Описание):*:: Значение, которое указывает на ключ к конкретному кэшу сигналов выпуска. Для определения того, должен ли поток данных, обрабатываемый процессором Wait, быть отправлен в отношение 'успех' или 'ожидание', процессор проверяет сигналы в кэше, указанном этим ключом.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Target-Signal-Count*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Target Signal Count (Целевое количество сигналов)

[horizontal]
*DESCRIPTION (Описание):*:: Количество сигналов, которые должны быть в кэше (указанные с помощью идентификатора выпуска) для того, чтобы FlowFile, обрабатываемый процессором ожидания, был отправлен в отношение 'успех'. Если количество сигналов в кэше достигло этого числа, FlowFile направляется в отношение 'успех', и количество сигналов в кэше уменьшается на это значение. Если указано имя счетчика сигналов, этот процессор проверяет конкретный счетчик, в противном случае сравнивает общее количество сигналов в кэше.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Signal-Counter-Name
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Signal Counter Name (Сигнальный Счетчик Имя)

[horizontal]
*DESCRIPTION (Описание):*:: В кэше (указанном по идентификатору сигнала выпуска) сигналы могут принадлежать разным счетчикам. Если это свойство указано, процессор проверяет количество сигналов в кэше, которые принадлежат конкретному счетчику. Если не указано, процессор проверяет общее количество сигналов в кэше.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Wait-Buffer-Count*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Wait Buffer Count (Максимальное количество входящих FlowFiles, которые могут быть буферизованы для проверки возможности перемещения вперед)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите максимальное количество входящих FlowFiles, которые могут быть буферизованы для проверки возможности перемещения вперед. Чем больше буфер может предоставить, тем лучше производительность, так как он уменьшает количество взаимодействий с кэш-сервисом за счет группировки FlowFiles по идентификатору сигнала. Только идентификатор сигнала может быть обработан на этапе выполнения процессора.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Releasable-Flowfile-Count*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Releasable FlowFile Count (Количество выпускаемых FlowFile)

[horizontal]
*DESCRIPTION (Описание):*:: Значение, или результат утверждения языка выражений атрибутов, которое будет оцениваться по отношению к FlowFile для определения количества выпускаемых FlowFile. Это определяет, сколько FlowFile можно выпустить, когда целевое количество достигнет целевого сигнального счета. Ноль (0) имеет особое значение, любое количество FlowFile может быть выпущено, если счетчик сигналов соответствует целевому.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables and FlowFile Attributes (Переменные среды и атрибуты FlowFile)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Expiration-Duration*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Expiration Duration (Срок действия)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает продолжительность, по истечении которой ожидающие FlowFiles будут направлены в отношение 'expired'


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Distributed-Cache-Service*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Distributed Cache Service (Распределенный кэш сервис)

[horizontal]
*DESCRIPTION (Описание):*:: The Controller Service that is used to check for release signals from a corresponding Notify processor


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Attribute-Copy-Mode*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Attribute Copy Mode (Режим копирования атрибутов)

[horizontal]
*DESCRIPTION (Описание):*:: Specifies how to handle attributes copied from FlowFiles entering the Notify processor


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Replace if present (Заменить, если присутствует): When cached attributes are copied onto released FlowFiles, they replace any matching attributes. 

* Keep original (Сохранить оригинальные): Attributes on released FlowFiles are not overwritten by copied cached attributes. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Wait-Mode*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Wait Mode (Режим ожидания)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает, как обрабатывать поток данных (FlowFile), ожидающий сигнала уведомления


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Transfer to wait relationship (Передать в отношение 'wait'): Передать FlowFile в отношение 'wait', если сигнал освобождения еще не был уведомлен. Этот режим позволяет другим поступающим FlowFiles быть помещенными в отношение 'wait'. Рекомендуется установить приоритезатор (например, FIFO) на отношение 'wait'. 

* Keep in the upstream connection (Оставить в исходном соединении): Передать FlowFile в исходное соединение, где он был получен, если сигнал освобождения еще не был уведомлен. Этот режим помогает поддерживать заполненность исходного соединения, что предотвращает планирование верхнего источника процессора при активных условиях обратной связи и ограничивает поступление новых FlowFiles. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Wait-Penalty-Duration
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Wait Penalty Duration (Период наложения штрафа)

[horizontal]
*DESCRIPTION (Описание):*:: Если настроено, после того как идентификатор сигнала был обработан, но не соответствует критериям освобождения, идентификатор сигнала наказывается, и FlowFiles с этим идентификатором сигнала больше не будут обрабатываться в течение указанного периода времени, чтобы предотвратить блокировку других процессов. Это может быть полезно для сценариев, где ожидается, что Wait processor обработает несколько идентификаторов сигналов, и каждый идентификатор сигнала имеет несколько FlowFiles, а также важен порядок освобождения FlowFiles в рамках одного идентификатора сигнала. Порядок FlowFile можно настроить с помощью Prioritizers. ВАЖНО: существует ограничение на количество очередных сигналов, которые могут быть обработаны, и Wait processor может не иметь возможности проверить все идентификаторы очередных сигналов. См. дополнительные сведения для лучших практик.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************










=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`expired`
|FlowFile, который превысил установленный срок действия Expiration Duration, будет направлен в это отношение

|`wait`
|FlowFile без соответствующего сигнала выпуска в кэше будет направлен в это отношение

|`success`
|FlowFile с соответствующим сигналом выпуска в кэше будет направлен в это отношение

|`failure`
|Когда кэш недоступен, или если Release Signal Identifier оценивается как null или пустая строка, FlowFiles будут направлены в это отношение

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`wait.start.timestamp`
|Все FlowFiles будут иметь атрибут 'wait.start.timestamp', который устанавливает начальную эпоху метки времени, когда файл впервые вошел в этот процессор. Это используется для определения срока действия FlowFile. Этот атрибут не записывается, если FlowFile передается в failure, expired или success

|`wait.counter.<counterName>`
|Каждый счетчик, для которого хотя бы один сигнал присутствовал в кэше с момента последнего времени, когда кэш был пуст, копируется в текущий FlowFile как атрибут.

|===







=== Смотрите также


* xref:Processors/DistributedMapCacheClientService.adoc[DistributedMapCacheClientService]

* xref:Processors/DistributedMapCacheServer.adoc[DistributedMapCacheServer]

* xref:Processors/Notify.adoc[Notify]


