= ListSmb 2.2.0

Перечисляет конкретные файлы, общие через протокол SMB. Каждый перечисленный файл может привести к одному flowfile, метаданные которого записываются в виде атрибутов flowfile. Или - в случае установки свойства 'Record Writer' - весь результат записывается как записи в единственный flowfile. Этот процессор предназначен для выполнения только на основном узле кластера. Если основной узел изменяется, новый основной узел продолжит работу с места остановки предыдущего узла без дублирования всех данных.

[horizontal]
*Tags* (Ключевые слова):
list, samba, smb, cifs, files
[horizontal]
*Input Requirement* (Требования к вводу данных):
FORBIDDEN
[horizontal]
*Supports Sensitive Dynamic* (Поддержка динамически изменяемых параметров, которые могут содержать конфиденциальную информацию):
 False (Нет) 



== Properties (Свойства)


.*Smb-Client-Provider-Service*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: SMB Client Provider Service (Сервис поставщика клиента SMB)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает используемого поставщика SMB для создания подключений SMB.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.*Listing-Strategy*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Listing Strategy (Стратегия перечисления)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как определить новые или обновленные сущности. Подробнее см. описание каждой стратегии.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Entities (Отслеживание сущностей): Эта стратегия отслеживает информацию всех перечисленных сущностей в пределах последнего 'Entity Tracking Time Window' для определения новых или обновленных сущностей. Эта стратегия может выбирать сущности с устаревшими временными метками, которые могут быть пропущены при использовании 'Tracking Timestamps'. Работает даже если одновременно записываются несколько поддиректорий во время выполнения операции перечисления. Однако требует дополнительного сервиса контроллера DistributedMapCache и использование большего объема памяти JVM. Подробнее о работе свойства 'Entity Tracking Time Window' можно узнать в его описании. 

* No Tracking (Без отслеживания): Эта стратегия перечисляет сущность без какого-либо отслеживания. Одна и та же сущность будет перечисляться каждый раз при выполнении этого процессора. Рекомендуется изменить значение параметра 'default run schedule'. Любые свойства, связанные с сохранением состояния, будут игнорироваться. 

* Tracking Timestamps (Отслеживание временных меток): Эта стратегия отслеживает последнюю временную метку перечисленной сущности для определения новых или обновленных сущностей. Поскольку она отслеживает только несколько временных меток, она может эффективно управлять состоянием перечисления. Однако любая новая или обновленная сущность с временной меткой старше отслеживаемой последней временной метки не будет выбрана этой стратегией. Например, такая ситуация может возникнуть в файловой системе, если файл с устаревшей временной меткой скопирован или перемещен в целевую директорию без обновления его последней модификации временной метки. Также может пропустить файлы при одновременной записи нескольких поддиректорий во время выполнения операции перечисления. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Directory
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Input Directory (Входная директория)

[horizontal]
*DESCRIPTION (Описание):*:: Сетевая папка, из которой будут перечислены файлы. Это оставшийся относительный путь после share: smb://HOSTNAME:PORT/SHARE/[DIRECTORY]/sub/directories. Также возможно добавление поддиректорий. Путь на удаленной файловой системе должен существовать. Это можно проверить с помощью проверки. Можно смешивать разделители Windows и Linux-style.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.File-Name-Suffix-Filter
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: File Name Suffix Filter (Имя файла Суффикс Фильтр)

[horizontal]
*DESCRIPTION (Описание):*:: Файлы, оканчивающиеся на заданный суффикс, будут исключены. Может быть использовано для того, чтобы убедиться, что файлы, которые все еще загружаются, не перечисляются несколько раз, добавляя суффикс к этим файлам и удаляя его после завершения загрузки. Это рекомендуется при использовании стратегий списка 'Отслеживание Сущностей' или 'Отслеживание Меток времени'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: 
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Record-Writer
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Record Writer (Записыватель записей)

[horizontal]
*DESCRIPTION (Описание):*:: Указывает записыватель записей для создания списка. Если не указан, будет создан один FlowFile для каждой перечисленной сущности. Если указать записыватель записей, все сущности будут записаны в один FlowFile вместо добавления атрибутов к отдельным FlowFiles.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Min-File-Age*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Minimum File Age (Минимальный возраст файла)

[horizontal]
*DESCRIPTION (Описание):*:: The minimum age that a file must be in order to be listed; any file younger than this amount of time will be ignored.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Max-File-Age
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Maximum File Age (Максимальный возраст файла)

[horizontal]
*DESCRIPTION (Описание):*:: Любой файл старше заданного значения будет исключён.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Min-File-Size
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Minimum File Size (Минимальный размер файла)

[horizontal]
*DESCRIPTION (Описание):*:: Любой файл меньше заданного значения будет пропущен.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Max-File-Size
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Maximum File Size (Максимальный размер файла)

[horizontal]
*DESCRIPTION (Описание):*:: Любой файл больше заданного значения будет пропущен.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.*Target-System-Timestamp-Precision*
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Target System Timestamp Precision (Точность временной метки системы)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите точность временной метки в целевой системе. Поскольку этот процессор использует временные метки сущностей для определения того, какие из них должны быть перечислены, важно использовать правильную точность временной метки.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Auto Detect (Автоматически обнаружить единицу времени на основе кандидатов): Автоматически определить единицу времени детерминированно на основе временной метки входных данных. Следует отметить, что этот параметр может занять больше времени для перечисления сущностей, если ни одна из записей не имеет точной временной метки. Например, даже если целевая система поддерживает миллисекунды, но все записи имеют временные метки без миллисекунд, такие как '2017-06-16 09:06:34.000', точность определяется как 'секунды'. 

* Milliseconds (Миллисекунды): Этот параметр обеспечивает минимальную задержку для входа, чтобы быть доступным для перечисления, если целевая система поддерживает миллисекунды, в противном случае используйте другие параметры. 

* Seconds (Секунды): Для целевой системы, которая не поддерживает миллисекунды, но имеет точность в секундах. 

* Minutes (Минуты): Для целевой системы, которая поддерживает только точность в минутах. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  True (Да) 
************************************************
.Et-State-Cache
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking State Cache (Состояние кэша отслеживания сущностей)

[horizontal]
*DESCRIPTION (Описание):*:: Перечисленные сущности хранятся в указанном хранилище кэша, что позволяет этому процессору возобновить перечисление после перезапуска NiFi или изменения основного узла. Стратегия 'Отслеживание сущностей' требует отслеживания информации обо всех перечисленных сущностях в течение последнего 'Окна времени отслеживания'. Для поддержки большого количества сущностей стратегия использует DistributedMapCache вместо управляемого состояния. Формат ключа кэша имеет вид 'ListedEntities::{processorId}(::{nodeId})'. Если отслеживаются перечисленные сущности на узле, то к ключу добавляется необязательная часть '::{nodeId}' для управления состоянием отдельно. Например, глобальный ключ кэша = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b', ключ кэша для узла = 'ListedEntities::8dda2321-0164-1000-50fa-3042fe7d6a7b::nifi-node3' Содержимое сжатой JSON строки хранится в кэше. Ключ будет удален, когда изменится конфигурация целевого перечисления. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Et-Time-Window
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Time Window (Временное окно отслеживания сущности)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как долго этот процессор должен отслеживать уже занесенные в список сущности. Стратегия 'Отслеживание сущностей' может выбирать любую сущность, временная метка которой находится внутри указанного временного окна. Например, если установлено значение '30 минут', то любое существование со временной меткой в течение последних 30 минут будет целью занесения при выполнении этого процессора. Занесенная сущность считается 'новой/обновленной', и поток данных (FlowFile) испускается, если выполняется одно из следующих условий: 1. не существует в уже занесенных сущностях, 2. имеет более новую временную метку, чем кэшированная сущность, 3. имеет отличный размер от кэшированной сущности. Если временная метка кэшированной сущности становится старше указанного временного окна, эта сущность будет удалена из кэшированных уже занесенных сущностей. Используется стратегией 'Отслеживание сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Environment variables defined at JVM level and system properties (Переменные окружения, определенные на уровне JVM и системных свойств)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************
.Et-Initial-Listing-Target
************************************************
[horizontal]
*DISPLAY NAME (Отображаемое наименование):*:: Entity Tracking Initial Listing Target (Целевая сущность для начального списка отслеживания)

[horizontal]
*DESCRIPTION (Описание):*:: Укажите, как следует обрабатывать начальный список. Используется стратегией 'Отслеживание Сущностей'.


[horizontal]
*EXPRESSION LANGUAGE SCOPE (Область видимости языка выражений):*:: Not Supported (Не поддерживается)
[horizontal]
*SENSITIVE (Содержит конфиденциальные данные):*::  False (Нет) 

[horizontal]
*ALLOWABLE VALUES (Допустимые значения):*::

* Tracking Time Window (Окно отслеживания времени): Игнорировать сущности, имеющие временную метку старше указанного 'Окна отслеживания времени' при начальной активности списка. 

* All Available (Все доступные): Независимо от временной метки сущностей, все существующие сущности будут перечислены при начальной активности списка. 


[horizontal]
*REQUIRED (Обязательный параметр):*::  False (Нет) 
************************************************




=== Управление состоянием

[cols="1a,2a",options="header",]
|===
|Масштаб |Описание

|
CLUSTER

|После выполнения перечисления файлов состояние предыдущего перечисления может быть сохранено для непрерывного перечисления файлов без дублирования.
|===







=== Relationships (Связи)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`success`
|Все FlowFiles, полученные на входе, маршрутизируются в success

|===





=== Writes Attributes (Записываемые атрибуты)

[cols="1a,2a",options="header",]
|===
|Наименование |Описание

|`filename`
|Имя файла, прочитанного с файловой системы.

|`shortName`
|Короткое имя файла, прочитанного из файловой системы.

|`path`
|Путь устанавливается в относительный путь директории файла на удаленной файловой системе по сравнению с корневой директорией Share. Например, для заданного удаленного расположения smb://HOSTNAME:PORT/SHARE/DIRECTORY и файл перечисляется из smb://HOSTNAME:PORT/SHARE/DIRECTORY/sub/folder/file, то атрибут path будет установлен в "DIRECTORY/sub/folder".

|`serviceLocation`
|URL SMB общей папки.

|`lastModifiedTime`
|Метка времени изменения содержимого файла в файловой системе в формате 'yyyy-MM-dd'T'HH:mm:ss'.

|`creationTime`
|Метка времени создания файла в файловой системе в формате 'yyyy-MM-dd'T'HH:mm:ss'.

|`lastAccessTime`
|Метка времени доступа к файлу в файловой системе в формате 'yyyy-MM-dd'T'HH:mm:ss'.

|`changeTime`
|Метка времени изменения атрибутов файла в файловой системе в формате 'yyyy-MM-dd'T'HH:mm:ss'.

|`size`
|Размер файла в байтах.

|`allocationSize`
|Количество байт, выделенных для файла на сервере.

|===







=== Смотрите также


* xref:Processors/FetchSmb.adoc[FetchSmb]

* xref:Processors/GetSmbFile.adoc[GetSmbFile]

* xref:Processors/PutSmbFile.adoc[PutSmbFile]


